### Конвейер `facets`

Конвейер `<q> | facets` возвращает **наиболее частые значения** для каждого встреченного [поля лога](https://docs.victoriametrics.com/victorialogs/keyconcepts/#data-model), полученного по запросу `<q>`. Также он выдаёт **оценку числа попаданий** (hits) для каждой пары `поле=значение`.

**Пример:** следующий запрос возвращает наиболее частые значения для всех полей логов, содержащих слово `error`, за последний час:

```logsql
_time:1h error | facets
```

Можно указать **количество наиболее частых значений**, которые нужно вернуть для каждого поля лога, используя синтаксис `facets N`. Например, следующий запрос вернёт **до 3 наиболее частых значений** для каждого поля в логах с словом `error` за последний час:

```logsql
_time:1h error | facets 3
```

По умолчанию конвейер `facets` **не возвращает поля логов с слишком большим числом уникальных значений** — это может потребовать значительного объёма дополнительной памяти для отслеживания. Лимит можно изменить в запросе с помощью суффикса `max_values_per_field M`. Например, следующий запрос вернёт до 15 наиболее частых значений полей, содержащих **не более 100 000 уникальных значений**:

```logsql
_time:1h error | facets 15 max_values_per_field 100000
```

По умолчанию `facets` **не возвращает поля логов со слишком длинными значениями**. Лимит можно изменить в запросе с помощью суффикса `max_value_len K`. Например, следующий запрос вернёт наиболее частые значения для всех полей логов, содержащих значения **не длиннее 100 байт**:

```logsql
_time:1h error | facets max_value_len 100
```

По умолчанию `facets` **не возвращает поля, содержащие единственное постоянное значение** во всех выбранных логах — такие фасеты в большинстве случаев не представляют интереса. Чтобы включить такие поля, добавьте суффикс `keep_const_fields`:

```logsql
_time:1h error | facets keep_const_fields
```
