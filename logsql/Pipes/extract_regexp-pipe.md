## Конвейер `extract_regexp`

Конструкция

```
<q> | extract_regexp "pattern" from field_name
```

извлекает подстроки из поля `field_name`, возвращённого запросом `<q>`, согласно заданному шаблону `pattern`, и сохраняет их в поля с именами, указанными в именованных группах шаблона.

Шаблон `pattern` должен содержать **регулярное выражение RE2** с именованными группами (так называемыми *захватывающими группами*) в форме `(?P<capture_field_name>...)`.

Найденные подстроки сохраняются в соответствующие поля журнала с именем `capture_field_name`.

### Пример

Следующий запрос извлекает IPv4‑адреса из поля `_msg` и помещает их в поле `ip` для логов за последние 5 минут:

```logsql
_time:5m | extract_regexp "(?P<ip>([0-9]+[.]){3}[0-9]+)" from _msg
```

Часть `from _msg` можно опустить, если извлечение данных выполняется из поля `_msg`. Тогда запрос будет эквивалентен предыдущему:

```logsql
_time:5m | extract_regexp "(?P<ip>([0-9]+[.]){3}[0-9]+)"
```

### Опция `keep_original_fields`

Добавьте `keep_original_fields` в конец конструкции `extract_regexp ...`, если нужно сохранить исходные непустые значения полей, упомянутых в шаблоне, вместо их перезаписи извлечёнными значениями.

Например, следующий запрос извлекает `ip` **только** в том случае, если исходное значение поля `ip` отсутствует или пусто:

```logsql
_time:5m | extract_regexp 'ip=(?P<ip>([0-9]+[.]){3}[0-9]+)' keep_original_fields
```

### Опция `skip_empty_results`

По умолчанию `extract_regexp` записывает в вывод пустые совпадающие поля, что может перезаписать существующие значения.

Чтобы предотвратить перезапись существующих значений пустых результатов, добавьте `skip_empty_results` в конец `extract_regexp ...`.

Например, следующий запрос сохраняет исходное значение поля `ip`, если в поле `foo` нет совпадающего IP‑адреса:

```logsql
_time:5m | extract_regexp 'ip=(?P<ip>([0-9]+[.]){3}[0-9]+)' from foo skip_empty_results
```

## Условный `extract_regexp`

Если некоторые записи журнала нужно пропустить в конвейере `extract_regexp`, добавьте `if (<filters>)` после слова `extract_regexp`.

В `<filters>` могут содержаться произвольные фильтры.

Например, следующий запрос извлекает `ip` из поля `_msg` **только** если входная запись журнала не содержит поля `ip` или это поле пусто:

```logsql
_time:5m | extract_regexp if (ip:"") "ip=(?P<ip>([0-9]+[.]){3}[0-9]+)"
```

Альтернативный подход — добавить `keep_original_fields` в конец `extract_regexp`, чтобы сохранить исходные непустые значения извлекаемых полей.

Например, следующий запрос эквивалентен предыдущему:

```logsql
_time:5m | extract_regexp "ip=(?P<ip>([0-9]+[.]){3}[0-9]+)" keep_original_fields
```
