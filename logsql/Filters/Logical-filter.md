### Логический фильтр

Базовые фильтры LogsQL `фильтры` можно объединять в более сложные с помощью следующих логических операций:

- `q1 AND q2` — отбирает записи журнала, которые возвращаются **и** `q1`, **и** `q2`. С помощью операции `AND` можно объединить произвольное число `фильтров`.  
  Например, `error AND file AND app` находит `сообщения журнала`, которые одновременно содержат слова `error`, `file` и `app`.  
  Операция `AND` часто используется в запросах LogsQL, поэтому допускается опускать слово `AND`.  
  Например, `error file app` эквивалентно `error AND file AND app`. 

- `q1 OR q2` — объединяет записи журнала, возвращаемые `q1` **или** `q2`. С помощью операции `OR` можно объединить произвольное число `фильтров`.  
  Например, `error OR warning OR info` находит `сообщения журнала`, которые содержат **хотя бы одно** из слов: `error`, `warning` или `info`. См. также фильтр ``contains_any``.

- `NOT q` — возвращает все записи журнала, **кроме** тех, что соответствуют `q`. Например, `NOT info` возвращает все `сообщения журнала`, которые **не содержат** слово `info`.  
  Операция `NOT` часто используется в запросах LogsQL, поэтому в запросах допускается заменять `NOT` на `-` и `!`.  
  Например, `-info` и `!info` эквивалентны `NOT info`.  
  Символ `!` **должен** использоваться вместо `-` перед фильтрами ``=`` и ``~``, например `!=` и `!~`.

**Приоритет операций:**  
- `NOT` имеет наивысший приоритет,  
- `AND` — средний,  
- `OR` — наименьший.  

Порядок приоритетов можно изменить с помощью скобок. Например, `NOT info OR debug` интерпретируется как `(NOT info) OR debug`, то есть отбирает `сообщения журнала`, которые не содержат слово `info`, а также сообщения со словом `debug` (которые могут содержать и `info`).  
Это не всегда соответствует ожиданиям пользователя. В таком случае запрос можно переписать как `NOT (info OR debug)` — он корректно вернёт сообщения журнала **без** слов `info` и `debug`.

LogsQL поддерживает произвольно сложные логические запросы с любым сочетанием операций `AND`, `OR`, `NOT` и скобок.

**По умолчанию** логические фильтры применяются к полю ``_msg``, если внутренние фильтры явно не указывают нужное `поле журнала` с помощью синтаксиса `имя_поля:фильтр`.  
Например, `(error OR warn) AND host.hostname:host123` интерпретируется как `(_msg:error OR _msg:warn) AND host.hostname:host123`.

Можно указать одно `поле журнала` для нескольких фильтров с помощью следующего синтаксиса:

```logsql
имя_поля:(q1 OR q2 OR ... qN)
```

Например, `log.level:error OR log.level:warning OR log.level:info` можно заменить более коротким запросом: `log.level:(error OR warning OR info)`.

**Советы по производительности:**

- VictoriaLogs выполняет логические операции **слева направо**, поэтому рекомендуется размещать **наиболее специфичные и быстрые** фильтры (такие как `фильтр по слову` и `фильтр по фразе`) **слева**, а **менее специфичные и медленные** (такие как `фильтр по регулярному выражению` и `фильтр без учёта регистра`) — **справа**.  
  Например, если нужно найти `сообщения журнала` со словом `error`, которые соответствуют регулярному выражению `/foo/(bar|baz)`, с точки зрения производительности лучше использовать запрос `error ~"/foo/(bar|baz)"`, а не `~"/foo/(bar|baz)" error`.  
  **Наиболее специфичный фильтр** — это тот, который отбирает наименьшее число записей журнала по сравнению с другими фильтрами.
